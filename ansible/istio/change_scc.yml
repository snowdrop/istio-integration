# Openshift by default does not allow containers running with UID 0. Enable containers running with UID 0 for Istioâ€™s service accounts
- name: Define SCC rules to enable containers running with UID zero for Istio service accounts
  command: oc adm policy add-scc-to-user anyuid -z {{item}}
  with_items:
    - istio-ingress-service-account
    - istio-egress-service-account
    - istio-pilot-service-account
    - istio-mixer-service-account
    - istio-ca-service-account

- name: Define SCC rules to enable containers running with UID zero for Prometheus service accounts
  command: oc adm policy add-scc-to-user anyuid -z istio-prometheus-service-account
  when: "'prometheus' in istio.addon"

- name: Define SCC rules to enable containers running with UID zero for Grafana service accounts
  command: oc adm policy add-scc-to-user anyuid -z istio-grafana-service-account
  when: "'grafana' in istio.addon"
